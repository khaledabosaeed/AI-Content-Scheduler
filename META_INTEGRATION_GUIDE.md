# ุฏููู ุฑุจุท Meta/Facebook ูุน AI Content Scheduler

## ๐ ูุธุฑุฉ ุนุงูุฉ
ูุฐุง ุงูุฏููู ูุดุฑุญ ุฎุทูุงุช ุฑุจุท Meta (Facebook) ูุชูููู ุงููุณุชุฎุฏููู ูู ูุดุฑ ูุญุชูุงูู ุนูู ุตูุญุงุชูู ุงูุฎุงุตุฉ ุนุจุฑ ุชุทุจููู.

---

## ๐ ููุงุฑูุฉ: ุงุณุชุฎุฏุงู ููุชุจุฉ OAuth vs ุจุฏูู ููุชุจุฉ

### **ุงูุทุฑููุฉ 1๏ธโฃ: ุงูุนูู ุจุฏูู ููุชุจุฉ (ุงูุทุฑููุฉ ุงููุฏููุฉ - ูุฐุง ุงูุฏููู)**

**ุงููููุฒุงุช:**
- โ ุชุญูู ูุงูู ูู ุนูููุฉ OAuth
- โ ููู ุนููู ูููููุฉ ุนูู OAuth
- โ ูุง ุชูุฌุฏ dependencies ุฅุถุงููุฉ ูุจูุฑุฉ
- โ ุฃุฎู ูุฒูุงู ุนูู ุงูุชุทุจูู
- โ ูุฑู ุฌุฏุงู ููุชุฎุตูุต
- โ ุชุนูููู ูุชุนูู ูููู

**ุงูุนููุจ:**
- โ ูุชุทูุจ ููุฏ ุฃูุซุฑ (~500 ุณุทุฑ)
- โ ุนุฑุถุฉ ูุฃุฎุทุงุก ุงูุฃูุงู ุฅุฐุง ูู ุชูู ุญุฐุฑุงู
- โ ูุฌุจ ูุนุงูุฌุฉ ุฌููุน ุงูุญุงูุงุช ูุฏููุงู
- โ ุฅุฏุงุฑุฉ sessions ูุฏููุฉ ูุนูุฏุฉ
- โ ุตูุงูุฉ ุฃุตุนุจ ุนูุฏ ุฅุถุงูุฉ providers ุฌุฏูุฏุฉ

**ุงููููุงุช ุงููุทููุจุฉ:**
```
4 ูููุงุช ุฌุฏูุฏุฉ + ุชุนุฏูู ููู ูุงุญุฏ = ุนูู ูุฏูู ุฃูุซุฑ
```

---

### **ุงูุทุฑููุฉ 2๏ธโฃ: ุงุณุชุฎุฏุงู NextAuth.js (ููุชุจุฉ ูุชุฎุตุตุฉ)**

**ุงููููุฒุงุช:**
- โ ููุชุจุฉ ููุซููุฉ ูุขููุฉ ุฌุฏุงู (ุงูุฃูุถู ูู ุงูุตูุงุนุฉ)
- โ ุชูุซูู ุดุงูู ูููุชุงุฒ
- โ ุฅุฏุงุฑุฉ sessions ุชููุงุฆูุฉ ูุขููุฉ
- โ ูุนุงููุฑ ุฃูุงู ุนุงููุฉ ุฌุฏุงู (CSRF protection)
- โ ุฏุนู OAuth providers ูุชุนุฏุฏุฉ (ุฌุงูุฒุฉ)
- โ ุญูุงูุฉ ูู ุงูุซุบุฑุงุช ุงูุดุงุฆุนุฉ
- โ ููุฏ ุฃูู ุจู 80% ุชูุฑูุจุงู
- โ ุณูู ุงูุฅุถุงูุฉ providers ุฌุฏูุฏุฉ

**ุงูุนููุจ:**
- โ dependency ุฅุถุงููุฉ (ุชุฒูุฏ ุญุฌู ุงูุชุทุจูู ุจู ~100 KB)
- โ ูุฏ ุชุญุชุงุฌ ุจุนุถ ุงูููุช ููุชุนูู
- โ ูุฏ ูููู ุฃูุซุฑ ูู ุงููุงุฒู ูููุดุงุฑูุน ุงูุจุณูุทุฉ ุฌุฏุงู

**ุงููููุงุช ุงููุทููุจุฉ:**
```
ููู ูุงุญุฏ (NextAuth config) = ุนูู ุฃูู ุจูุซูุฑ
```

---

### ๐ ุฌุฏูู ุงูููุงุฑูุฉ ุงูุชูุตููู:

| ุงูููุฒุฉ | ุงูุทุฑููุฉ ุงููุฏููุฉ | NextAuth.js |
|--------|-----------------|------------|
| **ุงูุฃูุงู** | ุฌูุฏ (ูุน ุงูุญุฐุฑ) | ููุชุงุฒ ุฌุฏุงู โ |
| **ุณูููุฉ ุงูุงุณุชุฎุฏุงู** | ูุชูุณุท | ุนุงูู โ |
| **ุนุฏุฏ ุงูุณุทูุฑ** | ~500+ ุณุทุฑ | ~100 ุณุทุฑ |
| **ุฅุฏุงุฑุฉ Sessions** | ูุฏููุฉ ูุนูุฏุฉ | ุชููุงุฆูุฉ ูุขููุฉ โ |
| **ุญูุงูุฉ CSRF** | ูุฌุจ ุชุทุจูููุง ูุฏููุงู | ูุฏูุฌุฉ โ |
| **ุฏุนู ูุชุนุฏุฏ ุงูู Providers** | ูุฌุจ ุฅุถุงูุชูุง ูุฏููุงู | ุฌุงูุฒุฉ ูุจุงุดุฑุฉ โ |
| **ูุนุงูุฌุฉ ุงูุฃุฎุทุงุก** | ูุฏููุฉ | ูุฏูุฌุฉ โ |
| **ุญุฌู ุงูููุชุจุฉ** | ูุง ููุฌุฏ | ~100 KB |
| **ุงูุชุนููุฏ** | ุนุงูู | ููุฎูุถ โ |
| **ุงูุตูุงูุฉ** | ุฃุตุนุจ | ุฃุณูู ุจูุซูุฑ โ |
| **ุงููุฑููุฉ** | ุนุงููุฉ ุฌุฏุงู | ูุชูุณุทุฉ (ูุงููุฉ ุนุงุฏุฉ) |

---

### ๐ฏ ุงูุชูุตูุฉ ุงูููุงุฆูุฉ:

**ุงุณุชุฎุฏู NextAuth.js ุฅุฐุง:**
- โ ุชุฑูุฏ ุฃูุงู ุนุงูู ุจุฏูู ูุดุงูู
- โ ุชุฑูุฏ ููุฏ ุฃูู ูุฃูุธู
- โ ุชุฑูุฏ ุฏุนู OAuth providers ูุชุนุฏุฏุฉ ูุงุญูุงู
- โ ูุฐุง ูู ุงูุฎูุงุฑ ุงูููุตู ุจู ูููุดุงุฑูุน ุงูุฌุฏูุฏุฉ
- โ ุชุฑูุฏ ูุดุฑูุน ุงุญุชุฑุงูู ุฌุงูุฒ ููุฅูุชุงุฌ

**ุงุณุชุฎุฏู ุงูุทุฑููุฉ ุงููุฏููุฉ ุฅุฐุง:**
- โ ุชุฑูุฏ ููู ุนููู ุฌุฏุงู ูู OAuth (ุชุนูููู)
- โ ุชุฑูุฏ ุชุญูู ูุงูู 100%
- โ ุงููุดุฑูุน ุจุณูุท ุฌุฏุงู ูุชุฌุฑูุจู
- โ ุชุชุนูู ูุฃูู ูุฑุฉ

---

### ๐ ุงููุฑุงุฑ ูู ูุฐุง ุงูุฏููู:

**ุณูุณุชุฎุฏู ุงูุทุฑููุฉ ุงููุฏููุฉ (ุจุฏูู ููุชุจุฉ) ูุฃู:**
1. โ ุชุนุทูู ููู ุนููู ูููููุฉ ุนูู OAuth
2. โ ุชูุงุณุจ ุงุญุชูุงุฌุงุช ุงููุดุฑูุน ุงูุญุงูู
3. โ ุชุณูู ุงูุชุฎุตูุต ูุงูุชุนุฏูู ูุงุญูุงู
4. โ ุชุนูููู ููููู ููุชุนูู

**ููุงุญุธุฉ:** ุฅุฐุง ุฃุฑุฏุช ุงุณุชุฎุฏุงู NextAuth.js ูุงุญูุงูุ ููููู ุชุญููู ุงูููุฏ ุจุณูููุฉ ุฃู ุงุณุชุฎุฏุงู ููุชุจุฉ OAuth ุฃุฎุฑู.

---

## ๐ง ุงูุฎุทูุงุช ุจุงูุชุฑุชูุจ

### **ุงูุฎุทูุฉ 1๏ธโฃ: ุฅุถุงูุฉ ูุชุบูุฑุงุช ุงูุจูุฆุฉ**

**ุงูููู:** `.env.local`

ุฃุถู ูุฐู ุงูุณุทูุฑ:
```env
# Meta/Facebook OAuth Configuration
META_APP_ID=256763785653130008
META_APP_SECRET=your_app_secret_here
META_REDIRECT_URI=http://localhost:3000/api/oauth/facebook/callback
```

**ููุงุญุธุงุช:**
- ุงุณุชุจุฏู `your_app_secret_here` ุจู App Secret ูู ููุญุฉ Meta Developer
- `META_APP_ID` ูู ุงูู App ID ุงูุฐู ุญุตูุช ุนููู
- ุงุญูุธ ูุฐุง ุงูููู ูุฃุนุฏ ุชุดุบูู ุงูุชุทุจูู

---

### **ุงูุฎุทูุฉ 2๏ธโฃ: ุฅูุดุงุก ููุชุจุฉ Meta ููุงุชุตุงู ุจู API**

**ุงูููู:** `src/shared/libs/meta/meta.ts`

**ุงููุฏู:** ููุชุจุฉ ุชุชุนุงูู ูุน ุฌููุน ุนูููุงุช Meta API

**ุงูุฏูุงู ุงููุทููุจุฉ:**
- `exchangeCodeForToken(code)` - ุชุญููู ุงูู Code ุฅูู Access Token
- `getUserPages(accessToken)` - ุงูุญุตูู ุนูู ุตูุญุงุช ุงููุณุชุฎุฏู
- `publishPost(pageId, message, accessToken)` - ูุดุฑ ุจูุณุช
- `publishPostWithImage(pageId, message, imageUrl, accessToken)` - ูุดุฑ ุจูุณุช ูุน ุตูุฑุฉ

**ุงูููุชุจุงุช ุงููุณุชุฎุฏูุฉ:**
- `process.env` - ูููุชุบูุฑุงุช ุงูุจูุฆูุฉ

---

### **ุงูุฎุทูุฉ 3๏ธโฃ: ุฅูุดุงุก ุตูุญุฉ OAuth Callback**

**ุงูููู:** `src/app/api/oauth/facebook/callback/route.ts`

**ุงููุฏู:** ุงุณุชูุจุงู ุงููุณุชุฎุฏู ุจุนุฏ ุงูุชูุซูู ูุญูุธ ุจูุงูุงุช ุชูููู

**ุงูุฎุทูุงุช ุงููุทููุจุฉ:**
1. ุงุณุชุฎุฑุงุฌ ุงูู `code` ู `error` ูู URL parameters
2. ุงูุชุญูู ูู ูุฌูุฏ ุฃุฎุทุงุก ูู Facebook
3. ุงุณุชุฏุนุงุก `exchangeCodeForToken()` ูุชุญููู ุงูููุฏ ุฅูู ุชููู
4. ุงุณุชุฏุนุงุก `getUserPages()` ููุญุตูู ุนูู ุตูุญุงุช ุงููุณุชุฎุฏู
5. ุญูุธ ุงูุจูุงูุงุช ูู ุฌุฏูู `user_facebook_accounts` ูู Supabase
6. ุฅุนุงุฏุฉ ุชูุฌูู ุงููุณุชุฎุฏู ููุฏุงุดุจูุฑุฏ ูุน ุฑุณุงูุฉ ุงููุฌุงุญ

---

### **ุงูุฎุทูุฉ 4๏ธโฃ: ุฅูุดุงุก ุตูุญุฉ ุฑุจุท Facebook**

**ุงูููู:** `src/app/link-facebook/page.tsx`

**ุงููุฏู:** ุตูุญุฉ ุชุญุชูู ุนูู ุฒุฑ ูุชูุตูู ุญุณุงุจ Facebook

**ุงูุฎุทูุงุช ุงููุทููุจุฉ:**
1. ุฅูุดุงุก React component ูุน ุญุงูุฉ client
2. ุฅูุดุงุก ุฏุงูุฉ `handleFacebookLogin` ุชููู ุจู:
   - ุจูุงุก URL Facebook OAuth
   - ุฅุถุงูุฉ `client_id`, `redirect_uri`, `scope`, `state`
   - ุฅุนุงุฏุฉ ุชูุฌูู ุงููุณุชุฎุฏู ูุตูุญุฉ Facebook
3. ุชุตููู ูุงุฌูุฉ ุฌูููุฉ ูุน ุฒุฑ "ุฑุจุท Facebook"

**ุงูุตูุงุญูุงุช ุงููุทููุจุฉ (Scope):**
```
pages_manage_posts
pages_read_user_content
pages_manage_metadata
```

**ูุชุบูุฑุงุช ุงูุจูุฆุฉ ุงูุนุงูุฉ (NEXT_PUBLIC):**
```env
NEXT_PUBLIC_META_APP_ID=256763785653130008
NEXT_PUBLIC_META_REDIRECT_URI=http://localhost:3000/api/oauth/facebook/callback
```

---

### **ุงูุฎุทูุฉ 5๏ธโฃ: ุฅูุดุงุก Endpoint ุงููุดุฑ ุนูู Facebook**

**ุงูููู:** `src/app/api/oauth/facebook/post/route.ts`

**ุงููุฏู:** ุงุณุชูุจุงู ุงูุจูุณุช ููุดุฑู ุนูู Facebook

**ุงูุฎุทูุงุช ุงููุทููุจุฉ:**
1. ุงุณุชุฎุฑุงุฌ `content` ู `postId` ูู request body
2. ุงูุชุญูู ูู ูุฌูุฏ ูุญุชูู ุงูุจูุณุช
3. ุงูุญุตูู ุนูู ุจูุงูุงุช Facebook ูู ุฌุฏูู `user_facebook_accounts`
4. ุงูุชุญูู ูู ุชุตู ุงููุณุชุฎุฏู ุญุณุงุจู
5. ุงุณุชุฏุนุงุก `publishPost()` ููุดุฑ ุงูุจูุณุช
6. ุชุญุฏูุซ ุญุงูุฉ ุงูุจูุณุช ูู ุฌุฏูู `posts` ุฅูู "published"
7. ุฅุฑุฌุงุน ุฑุณุงูุฉ ูุฌุงุญ ุฃู ุฎุทุฃ

---

### **ุงูุฎุทูุฉ 6๏ธโฃ: ุชุนุฏูู ุงูุฏุงุดุจูุฑุฏ**

**ุงูููู:** `src/features/user/dashboard/ui/Dashboard.tsx`

**ุงูุชุนุฏููุงุช:**
1. ุฃุถู ุฏุงูุฉ `handleFacebook` ูุดุงุจูุฉ ูู `handleTweet`
2. ุฃุถู ุฒุฑ "Facebook" ุจุฌุงูุจ ุฒุฑ "Tweet" ูู ุฌุฒุก ุงูุนุฑุถ (JSX)

**ุงูุฏุงูุฉ ุงููุทููุจุฉ:**
```
handleFacebook(post)
  - ุฅุฑุณุงู POST request ุฅูู `/api/oauth/facebook/post`
  - ูุฑุฑ `content` ู `postId` ูู ุงูุจูุณุช
  - ุฃุธูุฑ ุฑุณุงูุฉ ุชุฃููุฏ ูุจู ุงููุดุฑ
  - ุญุฏูุซ ุงูุญุงูุฉ ุฃุซูุงุก ุงููุดุฑ
  - ุฃุนุฑุถ ุฑุณุงูุฉ ูุฌุงุญ ุฃู ุฎุทุฃ
  - ุญุฏูุซ ูุงุฆูุฉ ุงูุจูุณุชุงุช ุจุนุฏ ุงููุฌุงุญ
```

**ุฎุตุงุฆุต ุงูุฒุฑ:**
- ูููู ุจุฌุงูุจ ุฒุฑ "tweet"
- ูุนุฑุถ "ุฌุงุฑู ุงููุดุฑ..." ุฃุซูุงุก ุงูุนูููุฉ
- ูููู ูุนุทู (disabled) ุฃุซูุงุก ุงููุดุฑ
- ููู ุฃุฒุฑู ููุงุณุจ Facebook

---

### **ุงูุฎุทูุฉ 7๏ธโฃ: ุฅูุดุงุก ุฌุฏูู ูู Supabase**

**ุงุณู ุงูุฌุฏูู:** `user_facebook_accounts`

**ุงูุฃุนูุฏุฉ ุงููุทููุจุฉ:**
- `id` - UUID primary key
- `user_id` - UUID ูุฑุฌุน ูููุณุชุฎุฏู
- `facebook_access_token` - ูุต (ุงูุชููู)
- `facebook_page_id` - ูุต (ุฑูู ุงูุตูุญุฉ)
- `facebook_page_name` - ูุต (ุงุณู ุงูุตูุญุฉ)
- `created_at` - timestamp
- `updated_at` - timestamp

**ุณูุงุณุงุช ุงูุฃูุงู (RLS):**
- ุงููุณุชุฎุฏููู ูููููู ุฑุคูุฉ ุญุณุงุจุงุชูู ููุท
- ุงููุณุชุฎุฏููู ูููููู ุชุญุฏูุซ ุญุณุงุจุงุชูู ููุท
- ุงููุณุชุฎุฏููู ูููููู ุฅุฏุฑุงุฌ ุญุณุงุจุงุชูู ููุท

---

## ๐ฑ ุงูุตูุงุญูุงุช ุงููุทููุจุฉ

ุนูุฏ ุฑุจุท ุญุณุงุจ Facebookุ ุงุทูุจ ูุฐู ุงูุตูุงุญูุงุช:
```
pages_manage_posts      - ููุดุฑ ุงูุจูุณุชุงุช
pages_read_user_content - ููุฑุงุกุฉ ูุญุชูู ุงูุตูุญุฉ
pages_manage_metadata   - ูุฅุฏุงุฑุฉ ูุนูููุงุช ุงูุตูุญุฉ
```

---

## ๐ ูุตุงุฆุญ ุงูุฃูุงู

1. **ุงุญูุธ ุงูู Tokens ุจุดูู ุขูู** - ุงุณุชุฎุฏู Supabase encrypted columns
2. **ูุง ุชุดุงุฑู App Secret** ูู ุงูู Frontend
3. **ุงุณุชุฎุฏู HTTPS** ูู ุงูุฅูุชุงุฌ
4. **ุชุญูู ูู ุงูู State Parameter** ููููุงูุฉ ูู CSRF attacks
5. **ุงุญุฐู ุงูู Tokens** ุนูุฏ ุญุฐู ุงูุญุณุงุจ

---

## ๐ ุงุณุชูุดุงู ุงูุฃุฎุทุงุก

| ุงููุดููุฉ | ุงูุญู |
|--------|------|
| `invalid_scope` | ุชุฃูุฏ ูู ุงูุตูุงุญูุงุช ุงูุตุญูุญุฉ |
| `invalid_client_id` | ุชุญูู ูู META_APP_ID ูู .env |
| `redirect_uri_mismatch` | ุชุฃูุฏ ูู ุชุทุงุจู Redirect URI |
| `expired_token` | ุงูุชููู ูุฏ ุงูุชูุช ุตูุงุญูุชูุ ุงุทูุจ ุชููู ุฌุฏูุฏ |

---

## ๐ ููุงุฑุฏ ุฅุถุงููุฉ

- [Meta Graph API Docs](https://developers.facebook.com/docs/graph-api)
- [Facebook Login Docs](https://developers.facebook.com/docs/facebook-login)
- [Publishing to Pages](https://developers.facebook.com/docs/graph-api/reference/page/feed)

---

## โ Checklist ุงููุดุฑ

- [ ] ุฃุถูุช ูุชุบูุฑุงุช ุงูุจูุฆุฉ
- [ ] ุฃูุดุฃุช ููุชุจุฉ Meta
- [ ] ุฃูุดุฃุช ุตูุญุฉ OAuth Callback
- [ ] ุฃูุดุฃุช ุตูุญุฉ ุฑุจุท Facebook
- [ ] ุฃูุดุฃุช endpoint ุงููุดุฑ
- [ ] ุนุฏูุช ุงูุฏุงุดุจูุฑุฏ
- [ ] ุฃูุดุฃุช ุฌุฏูู Supabase
- [ ] ุงุฎุชุจุฑุช ุงูุฑุจุท ูุงููุดุฑ

---

**ุชุงุฑูุฎ ุงูุฅูุดุงุก:** ููููุจุฑ 2024
**ุงูุฅุตุฏุงุฑ:** 1.0
