# ุฏููู ุงุฎุชุจุงุฑ ุญู ูุดููุฉ Flicker ูุงููุงุด

## โ ุฎุทูุงุช ุงูุชุญูู ูู ุงูุญู

### 1๏ธโฃ ุชุดุบูู ุงููุดุฑูุน

```bash
npm run dev
```

ุงูุชุญ ุงููุชุตูุญ ุนูู `http://localhost:3000`

---

### 2๏ธโฃ ูุชุญ React Query DevTools

```
ุฒุงููุฉ ูุณุงุฑ ุงูุตูุญุฉ ุชุญุช ุณุชุฌุฏ: React Query DevTools
ุฃู ุงุถุบุท: F12 โ ุงูุธุฑ ุชุญุช ุงูู window
```

---

### 3๏ธโฃ ุงูุชุญูู ูู ุงูุจูุงูุงุช

#### โ ุงุฎุชุจุฑ 1: ูู ุงูุจูุงูุงุช ูุฎุฒูุฉ ูู ุงููุงุด ูู ุงูุจุฏุงูุฉุ

```
1. ุงูุชุญ DevTools
2. ุงุถุบุท ุนูู "Queries"
3. ุดูู ุฅุฐุง ููุฌูุฏุฉ: ["user", "me"] โ
4. Status ูุฌุจ ูููู "success" ูููุณ "loading"
5. Data ูุฌุจ ูุญุชูู ุนูู ุจูุงูุงุช ุงูููุฒุฑ
```

**ุงููุชูุฌุฉ ุงููุชููุนุฉ**: โ ุงูุจูุงูุงุช ููุฌูุฏุฉ ูู ุฃูู ูููุฉ ุจุฏูู "loading" state

---

#### โ ุงุฎุชุจุฑ 2: ูู ููุฌุฏ Flickerุ

```
1. ุงูุชุญ ุงูุตูุญุฉ ุงูุฑุฆูุณูุฉ
2. ุดูู ุงูู Header
3. ุชููุน ุฃู ุชุฑู:
   - ุฅูุง "Login" (ุฅุฐุง ูุด ูุณุฌู ุงูุฏุฎูู)
   - ุฃู ุงุณู ุงูููุฒุฑ (ุฅุฐุง ูุณุฌู ุงูุฏุฎูู)
4. ุงูุจูุงูุงุช ูุฌุจ ุชุธูุฑ ูู ุฃูู ุงูุฑูุฉ โ
```

**ุงููุชูุฌุฉ ุงููุชููุนุฉ**: โ ูุง ุชุฑู "Login" ุซู ูุชุญูู ุฅูู ุงุณู ุงูููุฒุฑ

---

#### โ ุงุฎุชุจุฑ 3: ูู ุงูุจูุงูุงุช ูุง ุชููetch ูุฑุฉ ุซุงููุฉุ

```
1. ุงูุชุญ DevTools
2. ุงูุชุญ "Queries" ูู React Query
3. ุดูู ุนุฏุฏ requests ูู ุงูู Network tab
4. ูุฌุจ ูููู request ูุงุญุฏ ููุท: GET /api/auth/me
5. ุนูุฏ ูุชุญ ุตูุญุงุช ุฃุฎุฑูุ ุงูุจูุงูุงุช ูุง ุชููetch ูุฑุฉ ุซุงููุฉ โ
```

**ุงููุชูุฌุฉ ุงููุชููุนุฉ**: โ request ูุงุญุฏ ููุท ููุจูุงูุงุช

---

#### โ ุงุฎุชุจุฑ 4: ูู Stale Time ูุนูู ุตุญุ

```
1. ุงูุชุญ DevTools โ "Queries"
2. ุดูู ุงูุจูุงูุงุช ุชุญุช ["user", "me"]
3. ุจุนุฏ 5 ุฏูุงููุ ูุฌุจ ุชุตูุฑ ุงูุญุงูุฉ "stale" (ููู ูุง ุชููetch)
4. ุจุนุฏ 10 ุฏูุงููุ ูุฌุจ ุชูุญุฐู ูู ุงูู cache
```

**ุงููุชูุฌุฉ ุงููุชููุนุฉ**: โ ุงูุจูุงูุงุช ุชุตูุฑ stale ุจุนุฏ 5 ุฏูุงูู ููู ูุง ุชูุญุฐู ุฅูุง ุจุนุฏ 10

---

### 4๏ธโฃ ุงุฎุชุจุงุฑ Console Logs

ุงูุชุญ DevTools Console ูุดูู ุงูู logs:

```javascript
โ User data prefetched successfully  // ูู layout.tsx
Fetched user data: { ... }  // ูู queries.ts
```

---

### 5๏ธโฃ ุงุฎุชุจุฑ ุนูุฏ ุงููุดู

#### ุณููุงุฑูู: ูุดู ุฌูุจ ุงูุจูุงูุงุช

```
1. ุบููู ุงูุฅูุชุฑูุช (Offline)
2. ุงูุชุญ ุงูุตูุญุฉ
3. ูุฌุจ ุชุดูู:
   - Error ูู Console: "โ Failed to prefetch user data"
   - ููู ุงูุตูุญุฉ ุชุนูู ุจุดูู ุนุงุฏู
   - ุชุฌุฏ "Login" ุจุฏูุงู ูู ุงุณู ุงูููุฒุฑ
```

**ุงููุชูุฌุฉ ุงููุชููุนุฉ**: โ ุงูุตูุญุฉ ุชุนูู ุญุชู ูู ูุดู ุงูู fetch

---

## ๐ ูุคุดุฑุงุช ุงููุดููุฉ ูุญููููุง

| ุงููุดููุฉ | ุงูุณุจุจ | ุงูุญู |
|--------|------|------|
| ููุฌุฏ Flicker | ุงูุจูุงูุงุช ูู ุชูุญูู ูู ุงูุณูุฑูุฑ | ุชุฃูุฏ ูู `dehydratedState` |
| ุงูุจูุงูุงุช ูุง ุชุธูุฑ | `QueryProvider` ูุง ุงุณุชูุจู dehydratedState | ุงุถุงูุฉ `dehydratedState={dehydratedState}` |
| refetch ูุญุฏุซ ุจุฏูู ุฏุงุนู | `refetchOnMount: true` | ุบูุฑ ูู `false` |
| ุงูุจูุงูุงุช ูุฏููุฉ ุฌุฏุงู | `staleTime` ูุจูุฑ ุฌุฏุงู | ุบูุฑ ูู `5 * 60 * 1000` |

---

## ๐ ุงููููุงุช ุงููุนุฏูุฉ

| ุงูููู | ุงูุชุบููุฑ | ุงูุชุฃุซูุฑ |
|------|---------|---------|
| [app/layout.tsx](src/app/layout.tsx) | ุฃุถููุง `PrefetchUserData()` | ูุฌูุจ ุงูุจูุงูุงุช ุนูู ุงูุณูุฑูุฑ |
| [entities/user/state/queries.ts](src/entities/user/state/queries.ts) | ุบูุฑูุง ุงูู return type ูู JSON | ุงูุจูุงูุงุช ุชูุฑุฌุน ุจุดูู ุตุญูุญ |
| [app/_providers/query-provider.tsx](src/app/_providers/query-provider.tsx) | ุฃุถููุง `HydrationBoundary` | ุงูุจูุงูุงุช ุชูุญูู ุตุญ ูู ุงูููุงููุช |

---

## ๐ฏ ุงููุชูุฌุฉ ุงูููุงุฆูุฉ

ุจุนุฏ ุงูุชุบููุฑุงุช:
- โ **ุจุฏูู Flicker**: ุงูุจูุงูุงุช ุชุธูุฑ ูู ุฃูู ุงูุฑูุฉ
- โ **ุฃุณุฑุน**: ุจุฏูู request ุฅุถุงูู ููุจูุงูุงุช
- โ **ุฃูุซุฑ ุฃูุงูุงู**: ุงูู token ููุฑุณู ูู ุงูุณูุฑูุฑ ุจุฏูู ุนุฑุถู ุนูู ุงูููุงููุช
- โ **better UX**: ุงููุณุชุฎุฏู ูุฑู ุจูุงูุงุช ุตุญูุญุฉ ูู ุงูุจุฏุงูุฉ

---

## ๐ ุทุฑููุฉ ุฅุถุงููุฉ ููุงุฎุชุจุงุฑ

### ุงุณุชุฎุฏู Network Throttling

```
1. ุงูุชุญ DevTools โ Network
2. ุงุฎุชุงุฑ "Slow 4G"
3. ุงูุชุญ ุงูุตูุญุฉ
4. ุดูู ุฅู ุงูุจูุงูุงุช ุชุธูุฑ ุจุฏูู ุชุฃุฎูุฑ (ูุนุฑูุถุฉ ูู ุงูู cache)
```

---

## ๐ก ููุงุญุธุงุช

- ุงูู logs ุงูุฒุฑูุงุก (โ) ุชุธูุฑ ูู ุงูู console ุนูุฏ ุงููุฌุงุญ
- ุงูู logs ุงูุญูุฑุงุก (โ) ุชุธูุฑ ุนูุฏ ุงููุดู
- React Query DevTools ุจุชุณุงุนุฏู ุชุชุงุจุน ุญุงูุฉ ุงูู queries

---

## โ ุฃุณุฆูุฉ ุดุงุฆุนุฉ

### ุณ: ููุด ุงูุจูุงูุงุช ูุง ุชููetch ุนูู ุงูููุงููุชุ
**ุฌ**: ูุฃููู ููุญูููู ูู ุงูุณูุฑูุฑ ูุจุงุดุฑุฉ ุนุจุฑ `dehydratedState`

### ุณ: ูุชู ุชููetch ูุฑุฉ ุซุงููุฉุ
**ุฌ**: ุจุนุฏ 5 ุฏูุงูู (staleTime) ุฅุฐุง ุฌุงู ูุณุชุฎุฏู ุงูู query

### ุณ: ุฅูุด ูู ูุดู ุงูู prefetch ุนูู ุงูุณูุฑูุฑุ
**ุฌ**: ุงูุตูุญุฉ ุชุญููู ุจุดูู ุนุงุฏู ูุงูููุงููุช ุจุนุฏูู ูุญุงูู ูุฌูุจ ุงูุจูุงูุงุช

### ุณ: ููุด ุงุณุชุฎุฏููุง `enabled: false` ูู useUserุ
**ุฌ**: ุนุดุงู ูููุน refetch ุงูุฃููู - ุงูุจูุงูุงุช ููุฌูุฏุฉ ูู ุงูุณูุฑูุฑ!

---

## ๐ ููุงุฑุฏ ุฅุถุงููุฉ

- [React Query SSR Guide](https://tanstack.com/query/latest/docs/react/ssr)
- [Next.js Data Fetching](https://nextjs.org/docs/app/building-your-application/data-fetching)
- [Hydration in Next.js](https://nextjs.org/docs/app/building-your-application/rendering/client-components#hydration)
